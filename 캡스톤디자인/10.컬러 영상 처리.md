# 컬러 영상 처리

## 컬러 영상의 픽셀 값 참조

컬러 영상은 RGB색상 성분의 조합으로 픽셀 값을 표현함

OPENCV에서는 컬러 영상을 RGB색상 성분의 조합으로 표현하는 대신 BGR색상 성분의 조합으로 표현함

OPENCV에서는 컬러 영상의 한 픽셀을 표현하기 위해 일반적으로 Vec3b 자료형을 

픽셀 값을 참조할 때에는 Mat::at() 함수를 사용함

```cpp
Vec3b pixel = image.at<Vec3b>(0,0);
```
Vec3b 클래스는 [] 연산자 재정의를 이용하여 각 멤버 변수 값에 접근할 수 있음
    
```cpp
Vec3b pixel = image.at<Vec3b>(0,0);
uchar blue = pixel[0];
uchar green = pixel[1];
uchar red = pixel[2];
```

Mat::ptr() 함수를 사용하여 픽셀 값을 참조할 수도 있음

```cpp
Vec3b* ptr = image.ptr<Vec3b>(0);
```

포인터 변수 ptr에 특정 행 시작 주소를 받아 온 후에는 해당 행의 픽셀 값을 ptr[0], ptr[1], ptr[2]로 참조할 수 있음

```cpp
Vec3b* ptr = image.ptr<Vec3b>(0);
uchar blue = ptr[0];
uchar green = ptr[1];
uchar red = ptr[2];
```

### 색공간 변환

빨간색, 녹색, 파란색 세 가지 색 성분의 조합으로 색을 표현하는 방식을 RGB 색 모델 또는 RGB 색 공간 표현이라고 함

컴퓨터 비전, 영상처리 응용에서는 색상 구분이 용이한 HSV, HSL 색 공간이나, 휘도 성분과 색차 성분으로 구분되어 있는 YCbCr, YUV 색 공간을 사용함

BGR2GRAY

BGR컬러 영상을 그레이스케일 영상으로 변환할 때는 BGR2GRAY 코드를 사용하며, 컬러 영상을
그레이스케일 영상으로 변환하여 처리하는 주된 이유는 연산 속도를 높이고, 메모리 사용량을 줄이기
위합이다.

```cpp
cvtColor(src, dst, COLOR_BGR2GRAY);
```

BGR 3채널 컬러 영상을 그레이스케일 영상으로 변환할때에는 다음 공식을 사용함
    
```cpp
dst(x,y) = 0.114 * src(x,y)[0] + 0.587 * src(x,y)[1] + 0.299 * src(x,y)[2]
```
Y = 0.299R + 0.587G + 0.114B

RGB2HSV

HSV 색 모델은 색상, 채도, 명도 세 가지 성분으로 색을 표현함

OPENCV에서 BGR2HSV 색 공간 변환 코드를 이용하여 8비트 BGR영상을 HSV 영상을 변환할 경우, H 값은 0부터 179까지의 범위를 가지며, S와 V 값은 0부터 255까지의 범위를 가짐

```cpp
cvtColor(src, dst, COLOR_BGR2HSV);
```

BGR2YCrCb

YCrCb 색 공간에서 Y 성분은 휘도 정보를 나타낸다

Cr,Cb 성분은 색상 정보를 갖고 있는 성분으로 색차 신호라고 한다.

```cpp
cvtColor(src, dst, COLOR_BGR2YCrCb);
```

### 색상 채널 나누기

OPENCV에서 다채널 행렬을 1채널 행렬 여러 개로 변환할 때에는 split() 함수를 사용함

```cpp  
split(src, mv);
```

split()함수와 반대로 1채널 행렬 어러 개를 합쳐서 다채널 행렬 하나를 생성할 때에는 merge() 함수를 사용함

```cpp
merge(mv, dst);
```

## 컬러 영상 처리 기법

### 컬러 히스토그램 평활화

히스토그램 평활화는 영상의 히스토그램이 그레이스케일 전체 구간에서 균일한 분포로 나타나도록 
변경하는 명암비 향상 기법으로 히스토그램 균등화, 균일화, 평탄화라고도 한다.

3채널 컬러 영상에 대해 히스토그램 평활화를 수행하는 가장 간단한 방법은 입력 영상을 R,G,B 각 채널로 나누고, 채널별로 히스토글매 평활화 수행 후 채널을 합치는 방법이 있다.

R,G,B 색상 채널마다 서로 다른 형태의 명암비 변환 함수를 사용하게 됨으로써 원본 영상과 다른
색상의 결과 영상이 만들어지는 단점이 있다.

YCrCb 색 공간에서

Y 성분에 대해서만 히스토그램 평활화 수행시

컬러 영상의 색감은 손상시키지 않고, 영상의 명암비는 향상 시킬 수 있는 컬러 히스토그램 평활화 방법(밝기 신호만 분리하여 평활화)수행

-> 밝기 성분에 대해서만 명암비가 증가

### 색상 범위 지정에 의한 영역 분항

컬러 영상에서 빨간색 , 파란색 등의 대표적인 색상 영역을 구분할 때에는 RGB 색 공간보다 HSV 등의 색상(H) 정보가 따로 설정되어 있는 색 공간을 사용하는 것이 유리하다.

OPENCV에서 행렬의 원소 값이 특정 범위 안에 있는지 확인하려면 inRange() 함수를 사용한다.

```cpp
inRange(src, lowerb, upperb, dst);
```

inRange()함수는 입력 영상의 픽셀 값이 지정한 밝기 또는 색상 범위에 포함되어 있으면 흰색,
그렇지 않으면 검은색으로 채워진 마스크 영상을 반환한다.

### 히소트그램 역투영

주어진 입력 영상에서 미리 구해진 히스토그램 모델과 일치하는 픽셀을 찾아내는 기법을 히스토그램 역투영이라고 한다.
