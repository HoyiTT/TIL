# 에지 검출과 응용

## 에지 검출

영상에서 에지의 개념 

-> 영상에서 에지(edge)는 한쪽 방향으로 픽셀 값이 급격하게 바뀌는 부분을 가리킨다.

영상에서 에지 검출(에지를 찾아내는 작업)은 객체의 윤곽을 알아낼 수 있는 유용한 방법이다.

### 에지 검출 방법 - 미분과 그래디언트를 이용하는 방법

-> 영상에서 에지를 찾아내려면 픽셀 값의 변화율을 측정하여 변화율이 큰 픽셀을 선택해야한다.

함수의 미분 f'{x) 값이 0보다 훨씬 크거나 또는 훨씬 작은 위치가 함수 f(x)값이 급격하게
바뀌는 부분이며, 영상 데이터라면 이런 부분을 에지라고 할 수 있다.

영상은 정수 단위 좌표에 픽셀이 나열되어 있는 이산함수 이므로. 연속함수에 적용되는 미분 공식을 
그대로 적용할 수는 없다.

영상과 같이 일련의 데이터가 순서대로 나열되어 있는 경우에는 미분 근사화 방법을 이용하여 변화량을 측정할 수 있다.

영상은 2차원 평면에서 정의된 함수이기 때문에 영상에서 에지를 찾기 위해서는 영상을 가로 방향과
세로 방향으로 각각 미분해야한다.

2차원 공간에서 정의된 함수 f(x,y)가 있을 때 이 함수의 x축 방향 미분과 y축 방향 미분을 한꺼번에 벡터로 표현한 것을 그래디언트라 함

그래디언트는 벡터이기 때문에 크기와 방향 성분으로 표현할 수 있음
- 그래디언트 벡터의 크기는 변화율의 세기
- 그래디언트 벡터의 방향은 변화 정도가 가장 큰 방향을 나타냄

그래디언트 벡터의 방향은 해당 위치에서 밝기가 가장 밝아지는 방향을 가리킴

- 에지의 방향은 어두운 곳에서 밝은 곳으로 변화하는 곳(혹은 반대)을 의미하니까, 밝기가 가장 밝아 지는 방향을 나타내는 그래디언트 벡터와는 수직인 방향임

2차원 영역에서 에지를 찾는 기본적인 방법은 그래디언트 크기가 특정 값보다 큰 위치를 찾는 것임

- 여기에서 말하는 특정 값을 임계값 또는 문턱치라고함

### 마스크 기반에지 검출

잡음의 영향을 줄이기 위해 좀 더 큰 마스크를 사용하는 방법이 선호되고, 그 중 가장 널리 사용되고 있는 것이 소벨 필터임

샤르 필터는 3x3 소벨 필터 보다 잡음에 더 강한 특성이 있음


OpenCV는 2차원 벡터의 x 방향 좌표와 y 방향 좌표를 이용하여 벡터의 크기를 계싼하는 magnitude() 함수를 제공한다.

magnitude() 함수는 2차원 벡터의 크기를 계산하는 함수이므로, 그래디언트의 크기를 계산하는데 사용할 수 있다.

x방향 미분과 y방향 미분이 주어졌을 때, 그래디언트 방향은 phase() 함수를 사용하여 계산한다.

### 캐니 에지 검출기

1986년 캐니는 에지 검출을 최적화 문제 관점으로 접근함으로써 소벨 에지 검출 방법의 단점을 해결할 수 있는 방법을 제시함

캐니 에지 검출기는 그래디언트의 크기와 방향을 모두 고려하여 좀 더 정확한 에지 위치를 찾을 수 있다.

에지는 서로 연결되어 있는 가능성이 높다는 점을 고려하여 그래디언트 크기가 다소 약하게 나타나는 에지도 놓치지 않고 찾을 수 있음

캐니 에지 거출기의 두 번쨰 과정은 영상의 그래디언트를 구하는 작업임.

- 가로 방향과 세로 방향으로 각각 소벨 마스크 필터링을 수행한 후, 그래디언트 크기와 방향을 모두 걔산

캐니 에지 검출기에서는 비최대억제 괴정을 통해, 에지가 두껍게 되는 것을 방지하고, 에지의 위치를 정확하게 찾을 수 있음

- 캐니 에지 검출기의 비최대 억제 과정에서는, 그래디언트 벡터의 방향과 같은 방향에 있는 인접 픽셀끼리만 국지적 최대 검사를 수행하여, 위치를 정확하게 설정할 수 있음

캐니 에지 검출기의 마지막 단계에서는 히스테리시스 에지 트래킹 방법을 사용하여 약한 에지 중에서 최종적으로 에지로 판별한 픽셀을 설정함.

## 9.2 직선 검출과 원 검출

### 허프 변환 직선 검출

허프 변환은 2차원 xy좌표에서 직선의 방정식을 파라미터 공간으로 변환하여 직선을 찾는 알고리즘임


실제 허프 변환을 구현할 때에는 다음과 같이 극좌표계 형식의 직선의 방정식을 사용함

p 와 세타는 실수이기 떄문에 씨 코드로 축적 배열을 구현하려면 p와 세타가 가질 수 있는 값의 범위를 적당한 크기로 나눠서 저장하는 양자화 과정을 거쳐야함

### 허프 변환 원 검출

허프 그래디언트 방법을 사용함
1. 원의 중심을 찾고
2. 검출된 원의 중심으로부터 원에 적합한 반지름을 구함



